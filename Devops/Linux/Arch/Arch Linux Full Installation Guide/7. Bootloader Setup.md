## ðŸ“˜ Overview
The **bootloader** is the first program that runs when your computer starts. It loads the **Linux kernel** and transfers control to it.  
In modern Arch Linux installations, **GRUB** is the standard bootloader, especially for:

- **UEFI systems**
- **Encrypted LVM root partitions**
- Multiple kernels

This note explains how to configure GRUB with **UEFI + LUKS + LVM**.

---

## ðŸ§  1. Install Required Packages

	pacman -S grub dosfstools efibootmgr lvm2 mtools

### Explanation

- **grub** â†’ The GRUB bootloader package.
    
- **dosfstools** â†’ Utilities to manage FAT filesystems (EFI system partition).
    
- **efibootmgr** â†’ Tool to manage UEFI boot entries.
    
- **lvm2** â†’ Required for GRUB to read **LVM volumes**.
    
- **mtools** â†’ Utilities for FAT filesystem manipulation.
    

---

## ðŸ§  2. Mount the EFI Partition

`mkdir -p /boot/EFI mount /dev/sdb1 /boot/EFI`

### Explanation

- EFI system partition must be mounted at `/boot/EFI`.
    
- GRUB will install its EFI binary here.
    
- `/dev/sdb1` â†’ Your FAT32 EFI partition.
    

---

## ðŸ§  3. Configure Kernel Hooks for Encrypted LVM

`nano /etc/mkinitcpio.conf`

- Edit the **HOOKS** line and include `encrypt lvm2` **between `block` and `filesystems`**:
    

`HOOKS=(base udev autodetect modconf block encrypt lvm2 filesystems keyboard fsck)`

`mkinitcpio -p linux mkinitcpio -p linux-lts`

### Explanation

- Ensures **initramfs** can unlock encrypted partitions and detect LVM at boot.
    
- Rebuilding initramfs is necessary whenever hooks or kernel parameters change.
    

---

## ðŸ§  4. Configure GRUB for Encrypted Root

`nano /etc/default/grub`

- Add the following line:
    

`GRUB_CMDLINE_LINUX_DEFAULT="cryptdevice=/dev/sdb4:main_lvm root=/dev/main_volgroup0/lv_root quiet"`

### Explanation

- `cryptdevice=/dev/sdb4:main_lvm` â†’ Identifies the encrypted root partition.
    
- `root=/dev/main_volgroup0/lv_root` â†’ Tells the kernel where the root filesystem is inside LVM.
    
- `quiet` â†’ Suppresses verbose boot messages.
    

---

## ðŸ§  5. Configure Additional Encrypted Volumes (Optional)

`nano /etc/crypttab`

- Example entry:
    

`data_volgroup0-data_lvm UUID=282835e9-9dd1-4229-b7a9-996aa5f1626c none luks`

### Explanation

- `crypttab` allows **automatic unlocking of additional encrypted volumes** at boot.
    
- `UUID` can be obtained with:
    

`blkid /dev/sda1`

---

## ðŸ§  6. Install GRUB to EFI

`grub-install --target=x86_64-efi --bootloader-id=grub_uefi --recheck`

### Explanation

- `--target=x86_64-efi` â†’ For UEFI systems.
    
- `--bootloader-id=grub_uefi` â†’ Name shown in UEFI boot menu.
    
- `--recheck` â†’ Forces GRUB to probe disks again.
    

---

## ðŸ§  7. Generate GRUB Configuration

`grub-mkconfig -o /boot/grub/grub.cfg`

- Generates `/boot/grub/grub.cfg` based on the current system.
    
- Detects kernels, LVM volumes, and encrypted partitions automatically.
    

---

## ðŸ’¡ Notes & Tips

- Verify the **EFI partition** is correctly mounted before running `grub-install`.
    
- Use `efibootmgr -v` to list UEFI boot entries.
    
- Always include `encrypt lvm2` in **initramfs hooks** for encrypted root.
    
- Double-check **UUIDs** in `/etc/crypttab` and `/etc/fstab`. Mistakes can prevent boot.
    
- For multiple kernels (`linux` + `linux-lts`), rebuild initramfs for both.